<!DOCTYPE html>
<html lang="en">
<head>
    <title>Rust and Swift (x) &middot; Chris Krycho</title>
    <meta name="description" content="I am reading through the Swift book, and comparing it to Rust, which I have also been learning over the past few months. As with the other posts in this series, these are off-the-cuff impressions, which may be inaccurate in various ways. I‚Äôd be happy to hear feedback! Note ‚Ä¶"/>

    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

<link rel='me' href='https://alpha.app.net/chriskrycho' data-type='follow' data-user-id='@chriskrycho'/>    <meta property="og:url" content="http://v4.chriskrycho.com/2015/rust-and-swift-x.html"/>
    <meta property="og:title" content="Rust and Swift (x)"/>
    <meta property="og:description" content="I am reading through the Swift book, and comparing it to Rust, which I have also been learning over the past few months. As with the other posts in this series, these are off-the-cuff impressions, which may be inaccurate in various ways. I‚Äôd be happy to hear feedback! Note ‚Ä¶"/>
        <meta property="og:image" content="http://v4.chriskrycho.com//assets/images/ck.png"/>
<link rel="author" href=""/>
<link rel="me" href=""/><meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@chriskrycho"/>
<meta name="twitter:creator" content="@chriskrycho"/>
    <meta name="twitter:title" content="Rust and Swift (x)"/>
    <meta name="twitter:description" content="I am reading through the Swift book, and comparing it to Rust, which I have also been learning over the past few months. As with the other posts in this series, these are off-the-cuff impressions, which may be inaccurate in various ways. I‚Äôd be happy to hear feedback! Note ‚Ä¶"/>
        <meta name="twitter:image" content="http://v4.chriskrycho.com/assets/images/ck.png"/>
    <link rel="me" href="http://stackoverflow.com/users/564181/chris-krycho"/>
    <link rel="me" href="https://github.com/chriskrycho"/>
    <link rel="me" href="https://patreon.com/chriskrycho"/>
    <link rel="me" href="https://soundcloud.com/chriskrycho"/>
    <link rel="me" href="https://vimeo.com/chriskrycho"/>
    <link rel="me" href="https://cash.me/$chriskrycho"/>
    <link rel="me" href="https://twitter.com/chriskrycho"/>
    <link rel="me" href="mailto:chris at chriskrycho dot com"/>
    <link rel="me" href="http://www.linkedin.com/in/chriskrycho"/>

    <link rel="openid.delegate" href="http://v4.chriskrycho.com/" />
    <link rel="openid.server" href="https://indieauth.com/openid" />

    <link rel="stylesheet" type="text/css" href="/assets/fonts.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/style.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/archival.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css'>

    <link href="/favicon.png" type="image/png" rel="icon" />
    <link href="/favicon.ico" type="image/ico" rel="icon" />

    <script type="text/javascript" src="/assets/js/mtiFontTrackingCode.js"></script>


    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="All posts">
        <link rel="alternate" href="/feeds/Art.xml" type="application/rss+xml" title="Posts filed in in 'Art''">
        <link rel="alternate" href="/feeds/Blog.xml" type="application/rss+xml" title="Posts filed in in 'Blog''">
        <link rel="alternate" href="/feeds/Tech.xml" type="application/rss+xml" title="Posts filed in in 'Tech''">
        <link rel="alternate" href="/feeds/Theology.xml" type="application/rss+xml" title="Posts filed in in 'Theology''">
</head>
<body>
    <div id="archival-notice">This version of the site is now archived. See the next version at <a href="https://v5.chriskrycho.com">v5.chriskrycho.com</a>.</div>
    <header id="site-header">
        <div class="hgroup">
            <h1 id="site-title">
<a href="http://v4.chriskrycho.com"><img class="logotype" src="/assets/images/ck.png" alt="ck"/>Chris Krycho</a>
</h1>

            <h2 id="site-subtitle">Theology, technology, life & art</h2>
        </div>

        <nav>
            <ul>
                <li class="section-title"><a href="http://v4.chriskrycho.com/art/">Art</a></li>
                <li class="section-title"><a href="http://v4.chriskrycho.com/tech/">Tech</a></li>
                <li class="section-title"><a href="http://v4.chriskrycho.com/theology/">Theology</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://v4.chriskrycho.com/series.html">Series</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://v4.chriskrycho.com/about">About</a></li>
                <li class="section-title"><a href="http://v4.chriskrycho.com/cv">C.V.</a></li>
                <li class="section-title"><a href="http://v4.chriskrycho.com/now">Now</a></li>
            </ul>
        </nav>

    </header>


<article class="listicles software-development rust swift rust-and-swift tech">

    <header>
<h1>Rust and Swift (x)</h1>
<h2>Classes and structs (product types), and reference and value types.</h2>    </header>

    <div class="meta">
<span class="date"><a href="http://v4.chriskrycho.com/2015/rust-and-swift-x.html" title="Rust and Swift (x)"><i class="fa fa-fw fa-link"></i></a>December 06, 2015 (updated December 22, 2015)</span><span class="section">Filed under <a class="section-title" href="http://v4.chriskrycho.com/tech/">Tech</a></span><span class="hashtag"><a class="hashtags" href="http://v4.chriskrycho.com/listicles/">#listicles</a><a class="hashtags" href="http://v4.chriskrycho.com/rust/">#rust</a><a class="hashtags" href="http://v4.chriskrycho.com/rust-and-swift/">#rust-and-swift</a><a class="hashtags" href="http://v4.chriskrycho.com/software-development/">#software development</a><a class="hashtags" href="http://v4.chriskrycho.com/swift/">#swift</a></span><span><a href="http://v4.chriskrycho.com/2015/rust-and-swift-x.txt">Markdown source</a></span>    </div>

    <div class="content-wrapper">


        <div class="content">

<p><i class="editorial">I am reading through the Swift book, and comparing it to Rust, which I have also been learning over the past few months. As with the other posts in this series, these are off-the-cuff impressions, which may be inaccurate in various ways. I‚Äôd be happy to hear feedback! Note, too, that my preferences are just that: preferences. Your tastes may differ from mine. <a href="/rust-and-swift.html">(See all parts in the series.)</a></i></p>
<hr />
<ul>
<li><p>Swift and Rust both have ‚Äúproduct types‚Äù as well as the <code>enum</code> ‚Äúsum types.‚Äù In Rust, these are <code>struct</code> types; Swift splits them into <code>class</code>es and <code>struct</code>s.</p></li>
<li><p>‚ÄúProduct types‚Äù will be much more familiar to programmers coming from a C-like background, or indeed most object-oriented programming languages: these are the same basic kind of thing as classes, structs, and objects in other languages. These include <em>all</em> the value types which compose them, unlike sum types‚Äî<code>enum</code>‚Äîwhich have <em>only one</em> of the value types which compose them.</p></li>
<li><p>Right off the bat, I note the Swift book‚Äôs somewhat amusing reticence to call out C and C-descended languages:</p>
<blockquote>
<p>Unlike other programming languages, Swift does not require you to create separate interface and implementation files for custom classes and structures.</p>
</blockquote>
<p>Because there‚Äôs such a long list of languages not directly descended from C which do that, right? üòâ</p></li>
<li><p>Rust differs not only from Swift but from every other modern language I have used in not having a constructor <em>syntax</em> for its instantiations. Whereas C++ has <code>new NameOfType()</code> and Python and Swift both have <code>NameOfType()</code>, ‚Äúconstructors‚Äù for Rust <code>struct</code>s are just functions which return an instance constructed using literal syntax, by convention <code>NameOfType::new()</code>.</p></li>
<li><p>Let‚Äôs make a <code>struct</code> defining a location in a plane, you might do this in Swift (leaving aside initializer values; I‚Äôll come back to those later). These definitions look <em>very</em> similar. Swift:</p>
<pre class="swift"><code>struct Point {
    var x: Double var y: Double
}</code></pre>
<p>Rust:</p>
<pre class="rust"><code>struct Point {
    x: f64,
    y: f64,
}</code></pre></li>
<li><p>Creating the types looks a little different, though. Here‚Äôs a constructor in Swift:</p>
<pre class="swift"><code>let point = Point(x: 0, y: 0)</code></pre>
<p>And the two ways we could construct the type in Rust, a literal constructor (fairly similar to constructing <code>dict</code> literals in Python or object literals in JavaScript):</p>
<pre class="rust"><code>let point = Point { x: 0.0, y: 0.0 };</code></pre>
<p>Or a constructor method, <code>new</code>:</p>
<pre class="rust"><code>// &quot;Constructor&quot;
impl Point {
    fn new(x: f64, y: f64) -&gt; Point {
        Point { x: x, y: y }
    }
}

let another_point = Point::new(0, 0);</code></pre>
<p>Observe: these two things in Rust are the same under the covers (though if <code>Point</code>s had non-public internals, they would be non-trivially different: you couldn‚Äôt construct it with its private members externally). As usual, Rust opts to keep the language relatively small in these core areas. Given the plethora of ways you can construct something in e.g.¬†C++, I count that a big win.</p></li>
<li><p>Another difference: Swift has <em>syntax</em> for default values; Rust uses a <code>trait</code> instead. In Swift, you simply supply the default value in the definition of the <code>struct</code> or <code>class</code>:</p>
<pre class="swift"><code>struct Point {
    var x = 0.0 var y = 0.0
}

let point = Point()</code></pre>
<p>In Rust, you use <code>std::default::Default</code>, which provides a standard value for a given type, and for simple types can be supplied by the compiler even for custom types. Here is the equivalent Rust code:</p>
<pre class="rust"><code>use std::default::Default;

#[derive(Default)]
struct Point {
    x: f64,
    y: f64,
}

let point = Point::default();</code></pre>
<p>This is reasonable enough, but we can also supply our own custom implementation if we so desire:</p>
<pre class="rust"><code>use std::default::Default;

struct Point {
    x: f64,
    y: f64,
}

impl Default for Point {
    fn default() -&gt; Point {
        Point { x: 0.0, y: 0.0 }
    }
}

let point = Point::default();</code></pre>
<p>Of course, this is trivial for this type, but you can see how it could be useful for more complex types.</p></li>
<li><p>The tradeoffs here are our usual suspects: Rust‚Äôs re-use of an existing concept/tool within the language (<code>trait</code>) vs.¬†Swift‚Äôs use of syntax. Rust is slightly more explicit, making it obvious that a default value is being created‚Äîbut Swift is perfectly readable and the syntax is consistent with many other languages, and it <em>is</em> shorter.</p></li>
<li><p>Both languages use <code>.</code> syntax for member access. Swift:</p>
<pre class="swift"><code>println(&quot;The point is: \(point.x), \(point.y)&quot;)</code></pre>
<p>Rust:</p>
<pre class="rust"><code>println!(&quot;The point is {:}, {:}&quot;, point.x, point.y);</code></pre></li>
<li><p>Swift lets you define items <em>within</em> a struct as mutable or constant. So you can create a variable struct instance, with some of its items immutable:</p>
<pre class="swift"><code>struct PointOnZAxis {
    var x: Double var y: Double let z = 0.0
}

var point = PointOnZAxis(x: 4.0, 5.0)
point.x = 5.0 point.y = 6.0
// This wouldn&#39;t compile, though:
// point.z = 1.0</code></pre>
<p>This is pretty handy for a lot of object-oriented programming approaches.</p></li>
<li><p>And Rust doesn‚Äôt have it. There are ways to accomplish the same thing; this isn‚Äôt the end of the world. Still, it‚Äôs an interesting omission, and it‚Äôs very much by design. Rust <em>used</em> to have this feature, and dropped it‚Äîand for good reason. Say you had a mutable field in a mutable struct, and then an immutable reference to it; should the mutable field be mutable, or immutable, with that reference?</p></li>
<li><p>The Rusty way to do this is to differentiate between public and private data. The above examples don‚Äôt make the public/private distinction particularly clear, because they assume everything is within the same module. However, many times, this will not be the case.</p>
<pre class="rust"><code>mod geometry {
    pub struct Point {
        x: f64,
        pub y: f64,
    }

    impl Point {
        pub fn new() -&gt; Point {
            Point { x: 0.0, y: 0.0 }
        }

        pub fn set_x(&amp;mut self, x: f64) {
            self.x = x;
        }
    }
}

fn main() {
    // Won&#39;t compile: the `x` field is private.
    // let mut p = geometry::Point { x: 0.0, y: 0.0 };

    // Will compile: the `new` method is public.
    let mut p = geometry::Point::new();

    // Won&#39;t compile: `x` isn&#39;t public.
    // p.x = 4.0;
    // You can use the setter, though:
    p.set_x(4.0);

    // You *can* set `y` directly, though, because it&#39;s public.
    p.y = 14.0;

    // You can&#39;t set fields either way if the instance is immutable.
    let q = geometry::Point::new();

    // This fails because `set_x` requires a mutable reference, but `q` is
    // immutable.
    // q.set_x(4.0);

    // This fails because `q` is immutable, and so all its fields are, too.
    // q.y = 14.0;
}</code></pre></li>
<li><p>This is an interesting way of handling this issue. Rust takes the fairly standard use of information hiding (one of the basic principles of most object-oriented programming techniques) and combines it with the language‚Äôs normal mutability rules to make it so that the mutability of any given instance data is quite clear: all public members are just as mutable as the struct. If a member isn‚Äôt potentially publicly mutable, it isn‚Äôt publicly accessible. I really like this, though it took some mental readjustment.</p></li>
<li><p>There‚Äôs one other difference here, and it‚Äôs actually one of the areas Swift and Rust diverge substantially. Rust has <code>struct</code> for all product types; Swift splits them into <code>struct</code> types and <code>class</code> types.</p></li>
<li><p>Swift <code>class</code>es have inheritance; there is presently <em>no</em> inheritance in Rust.</p></li>
<li><p>Additionally, whereas Rust determines whether to use pass-by-reference or-value depending on details of the type (whether it implements the <code>Copy</code> <code>trait</code>) and expected arguments to a function, Swift makes that distinction between <code>class</code> (pass-by-reference) and <code>struct</code> (pass-by-value) types. Quirky.</p></li>
<li><p>Not bad, <em>per se</em>. But quirky.</p>
<p><strong>Edit:</strong> I recently bumped into some discussion of data types in C‚ôØ along with C, C++, and Java (<a href="http://joeduffyblog.com/2015/12/19/safe-native-code/">here</a>) and discovered that Swift is stealing this idea from C‚ôØ, which <a href="https://msdn.microsoft.com/en-us/library/0taef578.aspx">makes the same copy/reference distinction</a> between <code>struct</code> and <code>class</code>.</p></li>
<li><p>One consequence of this: in Rust, you‚Äôre always rather explicit about whether you‚Äôre accessing things by value vs.¬†by reference. Not so in Swift; you have to remember whether the item you‚Äôre touching is a <code>struct</code> type or a <code>class</code> type, so that you can <em>remember</em> whether a given assignment or function call results in a reference or a copy. This is necessary because Swift doesn‚Äôt let you make that explicit (trying to hide the memory management from you). And it‚Äôs not alone in that, of course; many other high-level languages obscure that for convenience but still require you to think about it in certain circumstances. I‚Äôve been bitten in the past by the value/reference distinction when thinking through the behavior of Python objects, for example, so that‚Äôs not a critique of Swift. Moreover, having the distinction between <code>struct</code> and <code>class</code> types does let you be <em>more</em> explicit than you might in e.g.¬†Python about how given data will be handled.</p></li>
<li><p>I won‚Äôt lie, though: I like Rust‚Äôs approach better. (Shocking, I know.)</p></li>
<li><p>All that nice initializer syntax for Swift <code>struct</code> types is absent for its <code>class</code> types, which seems strange to me.</p></li>
<li><p>Swift supplies some syntax for object identity, since it‚Äôs useful to know not only whether two <code>class</code> instances have the same data, but are in fact the same instance. You can use <code>===</code> and <code>!==</code>. Handy enough. To get at this kind of equivalence in Rust, you have to use raw pointers (which are often but not always <code>unsafe</code>; you can do this specific comparison <em>without</em> being <code>unsafe</code>, for example) to check whether the memory addresses are the same.</p></li>
</ul>
<hr />
<ul>
<li><a href="http://v4.chriskrycho.com/2015/rust-and-swift-ix.html"><strong>Previous:</strong> Sum types (<code>enum</code>s) and more on pattern matching.</a></li>
<li><a href="http://v4.chriskrycho.com/2016/rust-and-swift-xi.html"><strong>Next:</strong> Hopes for the next generation of systems programming.</a></li>
</ul>
        </div>
    </div>
</article>


    <footer id="site-footer"><section id="connect">
    <h2>Connect</h2>
    <ul class="icons">
        <li><a href="mailto:chris at chriskrycho dot com"><i class="fa fa-fw fa-envelope"></i>Email</a></li>
        <li><a href="https://github.com/chriskrycho"><i class="fa fa-fw fa-github"></i>GitHub</a></li>
        <li><a href="https://twitter.com/chriskrycho"><i class="fa fa-fw fa-twitter"></i>Twitter</a></li>
        <li><a href="https://soundcloud.com/chriskrycho"><i class="fa fa-fw fa-soundcloud"></i>SoundCloud</a></li>
        <li><a href="http://www.linkedin.com/in/chriskrycho"><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a></li>
        <li><a href="https://vimeo.com/chriskrycho"><i class="fa fa-fw fa-vimeo"></i>Vimeo</a></li>
        <li><a href="http://stackoverflow.com/users/564181/chris-krycho"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a></li>
    </ul>
    <h3>Support Me</h3>
    <ul class='icons'>
        <li><a href="https://patreon.com/chriskrycho"><i class='fa fa-fw fa-money'></i>Patreon</a></li>
        <li><a href="https://cash.me/$chriskrycho"><i class='fa fa-fw fa-usd'></i>Cash.me</a></li>
    </ul>
</section>
<section id="subscribe">
    <h2>Subscribe</h2>
    <ul class="icons">
        <li class="section-title">
            <a onclick="window.open('http://eepurl.com/GzswP', 'subscribe', 'width=608,height=608')">
                   <i class="fa fa-fw fa-envelope"></i>Email
            </a>
        </li>
    </ul>
    <h3>Feeds</h3>
    <ul class="icons">
        <li class="section-title">
            <a href="http://v4.chriskrycho.com/feed.xml"><i class="fa fa-fw fa-rss"></i>Everything</a>
        </li>
        <li class="section-title">
            <a href="http://v4.chriskrycho.com/feeds/Art.xml"><i class="fa fa-fw fa-rss"></i>Art</a>
        </li>
        <li class="section-title">
            <a href="http://v4.chriskrycho.com/feeds/Blog.xml"><i class="fa fa-fw fa-rss"></i>Blog</a>
        </li>
        <li class="section-title">
            <a href="http://v4.chriskrycho.com/feeds/Tech.xml"><i class="fa fa-fw fa-rss"></i>Tech</a>
        </li>
        <li class="section-title">
            <a href="http://v4.chriskrycho.com/feeds/Theology.xml"><i class="fa fa-fw fa-rss"></i>Theology</a>
        </li>
    </ul>
</section>
<section id="recent">
    <h2>Recent</h2>
    <ul>
        <li>Art: <a href="http://v4.chriskrycho.com/2019/photography-ing-again.html">Photography-ing Again!</a></li>
        <li>Blog: <a href="http://v4.chriskrycho.com/2019/sympolymathesy-or-v5chriskrychocom.html">Sympolymathesy, or: v5.chriskrycho.com
</a></li>
        <li>Tech: <a href="http://v4.chriskrycho.com/2019/test-the-interface.html">Test the Interface</a></li>
        <li>Theology: <a href="http://v4.chriskrycho.com/2019/review-what-is-an-evangelical.html">Review: <cite>What is an Evangelical</cite>
</a></li>
    </ul>
</section></footer>

    <script type="text/javascript">
    var MTIProjectId='a34d2e31-99b5-469a-9b81-128fc0bd9745';
    </script>

<link rel="stylesheet" href="/assets/tomorrow.min.css">
<script src="/assets/js/highlight.pack.js"></script>
<script type="text/javascript">
// Get all the <pre><code> elements, and use the <pre> element to set the <code>
// element's class so hljs will use it rather than trying to figure it out.
var preEls = document.getElementsByTagName('pre');
for (var e in preEls) {
    var pre = preEls[e];
    if (pre.firstChild && pre.firstChild.tagName === 'CODE') {
        var code = pre.firstChild;
        code.className = pre.className;
    }
}

// Then run hljs.
hljs.initHighlightingOnLoad();
</script>

<script type="text/javascript" src="/assets/js/lib.js"></script>
</body>
</html>