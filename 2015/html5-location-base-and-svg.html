<!DOCTYPE html>
<html lang="en">
<head>
    <title>HTML5 Location, <base>, and SVG &middot; Chris Krycho</title>
    <meta name="description" content="Angular requires if you want to use HTML5's location… but if you get it wrong, SVG things can and will break under you."/>

    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

<link rel='me' href='https://alpha.app.net/chriskrycho' data-type='follow' data-user-id='@chriskrycho'/>    <meta property="og:url" content="http://www.chriskrycho.com/2015/html5-location-base-and-svg.html"/>
    <meta property="og:title" content="HTML5 Location, <base>, and SVG"/>
    <meta property="og:description" content="Angular requires if you want to use HTML5's location… but if you get it wrong, SVG things can and will break under you."/>
        <meta property="og:image" content="http://www.chriskrycho.com//assets/images/ck.png"/>
<link rel="author" href=""/>
<link rel="me" href=""/><meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@chriskrycho"/>
<meta name="twitter:creator" content="@chriskrycho"/>
    <meta name="twitter:title" content="HTML5 Location, <base>, and SVG"/>
    <meta name="twitter:description" content="Angular requires if you want to use HTML5's location… but if you get it wrong, SVG things can and will break under you."/>
        <meta name="twitter:image" content="http://www.chriskrycho.com/assets/images/ck.png"/>
    <link rel="me" href="mailto:chris at chriskrycho dot com"/>
    <link rel="me" href="https://github.com/chriskrycho"/>
    <link rel="me" href="http://www.linkedin.com/in/chriskrycho"/>
    <link rel="me" href="https://soundcloud.com/chriskrycho"/>
    <link rel="me" href="http://stackoverflow.com/users/564181/chris-krycho"/>
    <link rel="me" href="https://twitter.com/chriskrycho"/>
    <link rel="me" href="https://vimeo.com/chriskrycho"/>

    <link rel="openid.delegate" href="http://www.chriskrycho.com/" />
    <link rel="openid.server" href="https://indieauth.com/openid" />

    <link rel="stylesheet" type="text/css" href="/assets/style.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/fonts.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css'>

    <link href="/favicon.png" type="image/png" rel="icon" />
    <link href="/favicon.ico" type="image/ico" rel="icon" />

    <script type="text/javascript" src="/assets/js/mtiFontTrackingCode.js"></script>


    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="All posts">
        <link rel="alternate" href="/feeds/Art.xml" type="application/rss+xml" title="Posts filed in in 'Art''">
        <link rel="alternate" href="/feeds/blog.xml" type="application/rss+xml" title="Posts filed in in 'Blog''">
        <link rel="alternate" href="/feeds/Tech.xml" type="application/rss+xml" title="Posts filed in in 'Tech''">
        <link rel="alternate" href="/feeds/Theology.xml" type="application/rss+xml" title="Posts filed in in 'Theology''">
</head>
<body>
    <header id="site-header">
        <div class="hgroup">
            <h1 id="site-title">
<a href="http://www.chriskrycho.com"><img class="logotype" src="/assets/images/ck.png" alt="ck"/>Chris Krycho</a>
</h1>

            <h2 id="site-subtitle">Theology, technology, life & art</h2>
        </div>

        <nav>
            <ul>
                <li class="section-title art"><a href="http://www.chriskrycho.com/art/">Art</a></li>
                <li class="section-title tech"><a href="http://www.chriskrycho.com/tech/">Tech</a></li>
                <li class="section-title theology"><a href="http://www.chriskrycho.com/theology/">Theology</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/series.html">Series</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/about">About</a></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/cv">C.V.</a></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/now">Now</a></li>
            </ul>
        </nav>

    </header>


<article class="software-development angularjs javascript tech">

    <header>
<h1>HTML5 Location, <code>&lt;base&gt;</code>, and SVG</h1>
<h2>Making Angular and SVG <code>xlink:href</code> work correctly in Firefox.
</h2>    </header>

    <div class="meta">
<span class="date"><a href="http://www.chriskrycho.com/2015/html5-location-base-and-svg.html" title="HTML5 Location, <base>, and SVG"><i class="fa fa-fw fa-link"></i></a>June 20, 2015 (updated July 02, 2015)</span><span class="section">Filed under <a class="section-title" href="http://www.chriskrycho.com/tech/">tech</a></span><span class="hashtag"><a class="hashtags" href="http://www.chriskrycho.com/angularjs/">#angularjs</a><a class="hashtags" href="http://www.chriskrycho.com/javascript/">#javascript</a><a class="hashtags" href="http://www.chriskrycho.com/software-development/">#software development</a></span><span><a href="http://www.chriskrycho.com/2015/html5-location-base-and-svg.txt">Markdown source</a></span>    </div>

    <div class="content-wrapper">


        <div class="content">

<p>For quite some time, I have been frustrated by a bug in HolyBible.com: Firefox would not render SVGs using the <code>&lt;use xlink:xhref=&quot;#some-SVG-ID&quot;&gt;&lt;/use&gt;</code> pattern. Today, I set aside my ongoing work on new user-facing functionality and dedicated what working time I had to hunting down the cause of this and fixing it at last.</p>
<p>I was surprised to find the culprit: the <code>&lt;base&gt;</code> tag. If you don’t know what the <code>&lt;base&gt;</code> tag is, you’re not alone. It is <em>not</em> used all that much in general, and I had never actually seen it on a site before starting on this project last year.</p>
<p>So what went wrong? How do these two things play together?</p>
<p>I am using (and reusing) SVG items throughout the HolyBible.com interface, taking advantage of the ability to define symbols and reference them with the <code>&lt;use&gt;</code> tag, like so:</p>
<pre class="html"><code>&lt;svg version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xmlns:ev=&quot;http://www.w3.org/2001/xml-events&quot; style=&quot;display: none&quot;&gt;
  &lt;symbol id=&quot;logo-shape&quot; viewBox=&quot;0 0 256 256&quot;&gt;
    &lt;title&gt;Logo&lt;/title&gt;
    &lt;desc&gt;The HolyBible.com logo: sunrise breaking over an open book (the Bible).&lt;/desc&gt;
    &lt;path id=&quot;logo-light&quot; d=&quot;M172.1 116.3l5.1-4.1-12.5-.5 32-26.3-41.4 18.4 11-20.1L148 96l12.2-37.5L138.8 91l.1-36.2-10.3 34.4L114 36.1l4.3 54.9-22.2-34.9 13 39.9-18.3-12.4 11 20.1-42.5-19.2 32.8 26.9-10.4.8 4.4 3.9c13.1-1.6 27.4-2.7 42.4-2.7 15.4 0 30.1 1.2 43.6 2.9z&quot;/&gt;
    &lt;path id=&quot;logo-book&quot; d=&quot;M199.9 219.9c-47.4-9.8-96.4-9.8-143.8 0-6-28.9-12-57.7-17.9-86.6 59.3-12.3 120.4-12.3 179.7 0-6 28.9-12 57.8-18 86.6z&quot;/&gt;
  &lt;/symbol&gt;
&lt;/svg&gt;

&lt;!-- somewhere else on the page --&gt;
&lt;svg&gt;
  &lt;use xlink:href=&quot;#logo-shape&quot;&gt;&lt;/use&gt;
&lt;/svg&gt;</code></pre>
<p>Throughout all my early prototyping, this worked perfectly across all modern browsers. (For more, see <a href="https://css-tricks.com/svg-sprites-use-better-icon-fonts/">CSS Tricks</a>.) Now, when I started moving from the prototype phase into actually building the application in Angular last fall, I learned that you have to set the base URL for the application using the <code>&lt;base&gt;</code> tag to use the HTML5 Location API with Angular 1.x. If you want URL-based, rather than <code>#</code>-based navigation in an Angular app, you need this. Following the recommendation of whatever documentation and tutorials I found, I set it so:</p>
<pre class="html"><code>&lt;base href=&quot;/&quot;&gt;</code></pre>
<p>Again, this was the recommendation I saw in every bit of documentation and every tutorial, so I assumed it would have no problems. As it turns it, that’s not the case. (This is a <a href="http://www.chriskrycho.com/2015/how-to-build-a-single-page-app-api-right.html">recurring theme</a> in my experience with Angular.) In Chrome, Safari, and IE9+, this works exactly as expected. In Firefox, however, it does <em>not</em>. The use of the <code>&lt;base&gt;</code> tag changes the behavior of <code>#</code>-based URLs on a page. Specifically, it makes it so that if you’re at a URL that <em>isn’t</em> the base route, anchor links don’t behave as expected. In order to make the <code>&lt;use&gt;</code> tag as expected, we would have to use the same URL as the base tag. Among other things, this would require making sure that any place we used the <code>&lt;use&gt;</code> tag, we would have to set that—not exactly a good idea, given that it would entail an awful lot of changes if the base URL were ever changed.</p>
<p>What if, instead, we did this?</p>
<pre class="html"><code>&lt;script&gt;document.write(&#39;&lt;base href=&quot;&#39; + document.location.origin + &#39;&quot; /&gt;&#39;);&lt;/script&gt;</code></pre>
<p>This way, when the page renders, it writes the document location based on the <em>current</em> location. The URL history still behaves as expected with Angular, but the relative URLs for IDs behave as expected in Firefox again, while not breaking the behavior in any other browsers.</p>
<p>But… then you’ll navigate to another page, and Firefox will be back to not working.</p>
<p>The <a href="https://github.com/angular/angular.js/issues/8934#issuecomment-56568466">solution</a>, it turns out, only came into being after I’d done the initial implementation, and I have no idea how much later it found its way into the Angular docs. However, even though it now <em>exists</em> in the docs, it’s by no means obvious why you should do it this way, and certainly no mention of SVG! This might not seem odd to you… but it should, given that the only reason that Angular introduced this API change was to account for <em>exactly this issue</em>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>As the Angular docs note, leaving out the <code>&lt;base&gt;</code> tag means all your URLs have to be absolute if you want to use HTML5 location and the <code>$locationProvider</code>. If you want to use SVGs with <code>&lt;use&gt;</code> and Firefox, though, that’s what you have to do (and therefore that’s what I’m doing).</p>
<p>Fun times, right?</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>The closest it gets is this reference:</p>
<blockquote>
<p>Links that only contain a hash fragment (e.g. <code>&lt;a href=&quot;#target&quot;&gt;</code>) will only change <code>$location.hash()</code> and not modify the url otherwise. This is useful for scrolling to anchors on the same page without needing to know on which page the user currently is.</p>
</blockquote>
<p>Even this, however, only <em>hints</em> at the root of the SVG issue.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</section>
        </div>
    </div>
</article>


    <footer id="site-footer"><section id="connect">
    <h2>Connect</h2>
    <ul class="icons">
        <li><a href="mailto:chris at chriskrycho dot com"><i class="fa fa-fw fa-envelope"></i>Email</a></li>
        <li><a href="https://github.com/chriskrycho"><i class="fa fa-fw fa-github"></i>GitHub</a></li>
        <li><a href="https://twitter.com/chriskrycho"><i class="fa fa-fw fa-twitter"></i>Twitter</a></li>
        <li><a href="https://soundcloud.com/chriskrycho"><i class="fa fa-fw fa-soundcloud"></i>SoundCloud</a></li>
        <li><a href="http://www.linkedin.com/in/chriskrycho"><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a></li>
        <li><a href="https://vimeo.com/chriskrycho"><i class="fa fa-fw fa-vimeo"></i>Vimeo</a></li>
        <li><a href="http://stackoverflow.com/users/564181/chris-krycho"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a></li>
    </ul>
</section>
<section id="subscribe">
    <h2>Subscribe</h2>
    <ul class="icons">
        <li class="section-title">
            <a onclick="window.open('http://eepurl.com/GzswP', 'subscribe', 'width=608,height=608')">
                   <i class="fa fa-fw fa-envelope"></i>Email
            </a>
        </li>
    </ul>
    <h3>Feeds</h3>
    <ul class="icons">
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feed.xml"><i class="fa fa-fw fa-rss"></i>Everything</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Art.xml"><i class="fa fa-fw fa-rss"></i>Art</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/blog.xml"><i class="fa fa-fw fa-rss"></i>blog</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Tech.xml"><i class="fa fa-fw fa-rss"></i>Tech</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Theology.xml"><i class="fa fa-fw fa-rss"></i>Theology</a>
        </li>
    </ul>
</section>
<section id="recent">
    <h2>Recent</h2>
    <ul>
        <li>Art: <a href="http://www.chriskrycho.com/2018/ringworld-review.html"><cite>Ringworld</cite> Review</a></li>
        <li>Blog: <a href="http://www.chriskrycho.com/2018/assumed-audiences.html">Assumed Audiences</a></li>
        <li>Tech: <a href="http://www.chriskrycho.com/2018/review-the-rust-programming-language.html">Review: <cite>The Rust Programming Language</cite>
</a></li>
        <li>Theology: <a href="http://www.chriskrycho.com/2018/dealing-with-burnout-in-public.html">Dealing With Burnout In Public</a></li>
    </ul>
</section></footer>

    <script type="text/javascript">
    var MTIProjectId='a34d2e31-99b5-469a-9b81-128fc0bd9745';
    </script>

<link rel="stylesheet" href="/assets/tomorrow.min.css">
<script src="/assets/js/highlight.pack.js"></script>
<script type="text/javascript">
// Get all the <pre><code> elements, and use the <pre> element to set the <code>
// element's class so hljs will use it rather than trying to figure it out.
var preEls = document.getElementsByTagName('pre');
for (var e in preEls) {
    var pre = preEls[e];
    if (pre.firstChild && pre.firstChild.tagName === 'CODE') {
        var code = pre.firstChild;
        code.className = pre.className;
    }
}

// Then run hljs.
hljs.initHighlightingOnLoad();
</script>

<script type="text/javascript" src="/assets/js/lib.js"></script>
</body>
</html>