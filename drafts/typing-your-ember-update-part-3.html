<!DOCTYPE html>
<html lang="en">
<head>
    <title>TypeScript and Ember.js Update, Part 3 &middot; Chris Krycho</title>
    <meta name="description" content="Now that we know a bit more about how computed properties work, we‚Äôll talk about computed properties, actions, and mixins on the Ember.js side, along with the normal class methods."/>

    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

<link rel='me' href='https://alpha.app.net/chriskrycho' data-type='follow' data-user-id='@chriskrycho'/>    <meta property="og:url" content="http://www.chriskrycho.com/drafts/typing-your-ember-update-part-3.html"/>
    <meta property="og:title" content="TypeScript and Ember.js Update, Part 3"/>
    <meta property="og:description" content="Now that we know a bit more about how computed properties work, we‚Äôll talk about computed properties, actions, and mixins on the Ember.js side, along with the normal class methods."/>
        <meta property="og:image" content="http://www.chriskrycho.com//assets/images/ck.png"/>
<link rel="author" href=""/>
<link rel="me" href=""/><meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@chriskrycho"/>
<meta name="twitter:creator" content="@chriskrycho"/>
    <meta name="twitter:title" content="TypeScript and Ember.js Update, Part 3"/>
    <meta name="twitter:description" content="Now that we know a bit more about how computed properties work, we‚Äôll talk about computed properties, actions, and mixins on the Ember.js side, along with the normal class methods."/>
        <meta name="twitter:image" content="http://www.chriskrycho.com/assets/images/ck.png"/>
    <link rel="me" href="https://bitbucket.org/chriskrycho"/>
    <link rel="me" href="mailto:chris at chriskrycho dot com"/>
    <link rel="me" href="https://www.facebook.com/chriskrycho"/>
    <link rel="me" href="https://github.com/chriskrycho"/>
    <link rel="me" href="http://instagram.com/chriskrycho"/>
    <link rel="me" href="http://www.linkedin.com/in/chriskrycho"/>
    <link rel="me" href="https://medium.com/@chriskrycho"/>
    <link rel="me" href="https://soundcloud.com/chriskrycho"/>
    <link rel="me" href="http://stackoverflow.com/users/564181/chris-krycho"/>
    <link rel="me" href="https://twitter.com/chriskrycho"/>
    <link rel="me" href="https://vimeo.com/chriskrycho"/>

    <link rel="openid.delegate" href="http://www.chriskrycho.com/" />
    <link rel="openid.server" href="https://indieauth.com/openid" />

    <link rel="stylesheet" type="text/css" href="/assets/style.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/fonts.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css'>

    <link href="/favicon.png" type="image/png" rel="icon" />
    <link href="/favicon.ico" type="image/ico" rel="icon" />

    <script type="text/javascript" src="/assets/js/mtiFontTrackingCode.js"></script>


    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="All posts">
        <link rel="alternate" href="/feeds/Art.xml" type="application/rss+xml" title="Posts filed in in 'Art''">
        <link rel="alternate" href="/feeds/blog.xml" type="application/rss+xml" title="Posts filed in in 'Blog''">
        <link rel="alternate" href="/feeds/Tech.xml" type="application/rss+xml" title="Posts filed in in 'Tech''">
        <link rel="alternate" href="/feeds/Theology.xml" type="application/rss+xml" title="Posts filed in in 'Theology''">
</head>
<body>
    <header id="site-header">
        <div class="hgroup">
            <h1 id="site-title">
<a href="http://www.chriskrycho.com"><img class="logotype" src="/assets/images/ck.png" alt="ck"/>Chris Krycho</a>
</h1>

            <h2 id="site-subtitle">Theology, technology, life & art</h2>
        </div>

        <nav>
            <ul>
                <li class="section-title"><a href="http://www.chriskrycho.com/about.html">About</a></li>
                <li class="section-title art"><a href="http://www.chriskrycho.com/art/">Art</a></li>
                <li class="section-title tech"><a href="http://www.chriskrycho.com/tech/">Tech</a></li>
                <li class="section-title theology"><a href="http://www.chriskrycho.com/theology/">Theology</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/series.html">Series</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/now.html">Now</a></li>
            </ul>
        </nav>

    </header>


<article class="typescript emberjs typing-your-ember tech">

    <header>
<h1>TypeScript and Ember.js Update, Part 3</h1>
<h2>Computed properties, actions, mixins, and class methods.
</h2>    </header>

    <div class="meta">
<span class="date"><a href="http://www.chriskrycho.com/drafts/typing-your-ember-update-part-3.html"><i class="fa fa-fw fa-link"></i></a>January 25, 2018</span><span class="section">Filed under <a class="section-title" href="http://www.chriskrycho.com/tech/">Tech</a></span><span class="hashtag"><a class="hashtags" href="http://www.chriskrycho.com/emberjs/">#emberjs</a><a class="hashtags" href="http://www.chriskrycho.com/typescript/">#typescript</a><a class="hashtags" href="http://www.chriskrycho.com/typing-your-ember/">#typing-your-ember</a></span><span><a href="http://www.chriskrycho.com/2018/typing-your-ember-update-part-3.txt">Markdown source</a></span>    </div>

    <div class="content-wrapper">


        <div class="content">

<p><i class='series-overview'>You write <a href="https://emberjs.com">Ember.js</a> apps. You think <a href="http://www.typescriptlang.org">TypeScript</a> would be helpful in building a more robust app as it increases in size or has more people working on it. But you have questions about how to make it work.</i></p>
<p><i class='series-overview'>This is the series for you! I‚Äôll talk through everything: from the very basics of how to set up your Ember.js app to use TypeScript to how you can get the most out of TypeScript today‚Äîand I‚Äôll be pretty clear about the current tradeoffs and limitations, too.</i></p>
<p><i class='series-overview'><a href="/typing-your-ember.html">(See the rest of the series. ‚Üí)</a></i></p>
<hr />
<p>In the previous posts in this series, I introduced the big picture of how the story around TypeScript and Ember.js has improved over the last several months and walked through some important background on class properties. In this post, I‚Äôll build on that foundation to look closely at computed properties, actions, and mixins.</p>
<aside>
<p>If you‚Äôre interested in all of this and would like to learn more in person, I‚Äôm <a href="http://emberconf.com/speakers.html#chris-krycho">leading a workshop on it at EmberConf 2018</a>‚ÄîI‚Äôd love to see you there!</p>
</aside>
<p>Here‚Äôs the outline of this update sequence:</p>
<ol type="1">
<li><a href="http://www.chriskrycho.com/2018/typing-your-ember-update-part-1.html">Overview, normal Ember objects, component arguments, and injections.</a></li>
<li><a href="http://www.chriskrycho.com/2018/typing-your-ember-update-part-2.html">Class properties‚Äîsome notes on how things differ from the <code>Ember.Object</code> world.</a></li>
<li><a href="http://www.chriskrycho.com/2018/typing-your-ember-update-part-3.html">Computed properties, actions, mixins, and class methods. (this post)</a></li>
<li>Ember Data and related concerns.</li>
</ol>
<section id="a-detailed-example-contd.-class-properties" class="level2">
<h2>A detailed example (cont‚Äôd.) ‚Äì class properties</h2>
<p>Let‚Äôs start by recalling the example Component we‚Äôre working through:</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;
import { computed, get } from &#39;@ember/object&#39;;
import Computed from &#39;@ember/object/computed&#39;;
import { inject as service } from &#39;@ember/service&#39;;
import { assert } from &#39;@ember/debug&#39;;
import { isNone } from &#39;@ember/utils&#39;;

import Session from &#39;my-app/services/session&#39;;
import Person from &#39;my-app/models/person&#39;;

export default class AnExample extends Component {
  // -- Component arguments -- //
  model: Person;      // required
  modifier?: string;  // optional, thus the `?`

  // -- Injections -- //
  session: Computed&lt;Session&gt; = service();

  // -- Class properties -- //
  aString = &#39;this is fine&#39;;
  aCollection: string[] = [];

  // -- Computed properties -- //
  // TS correctly infers computed property types when the callback has a
  // return type annotation.
  fromModel = computed(
    &#39;model.firstName&#39;,
    function(this: AnExample): string {
      return `My name is ${get(this.model, &#39;firstName&#39;)};`;
    }
  );

  aComputed = computed(&#39;aString&#39;, function(this: AnExample): number {
    return this.lookAString.length;
  });

  isLoggedIn = bool(&#39;session.user&#39;);
  savedUser: Computed&lt;Person&gt; = alias(&#39;session.user&#39;);

  actions = {
    addToCollection(this: AnExample, value: string) {
      const current = this.get(&#39;aCollection&#39;);
      this.set(&#39;aCollection&#39;, current.concat(value));
    }
  };

  constructor() {
    super();
    assert(&#39;`model` is required&#39;, !isNone(this.model));

    this.includeAhoy();
  }

  includeAhoy(this: AnExample) {
    if (!this.get(&#39;aCollection&#39;).includes(&#39;ahoy&#39;)) {
      this.set(&#39;aCollection&#39;, current.concat(&#39;ahoy&#39;));
    }
  }
}</code></pre>
<p>We already covered component arguments and injections as well as basic class properties. Now let‚Äôs look at the special cases of computed properties, actions, and mixins, before turning our attention</p>
<section id="computed-properties" class="level3">
<h3>Computed properties</h3>
<p>So now let‚Äôs talk about computed properties in a bit more detail! I‚Äôm including the component arguments</p>
<pre class="typescript"><code>  // -- Component arguments -- //
  model: Person;      // required
  modifier?: string;  // optional, thus the `?`

  // -- Computed properties -- //
  // TS correctly infers computed property types when the callback has a
  // return type annotation.
  fromModel = computed(
    &#39;model.firstName&#39;, 
    function(this: AnExample): string {
    return `My name is ${get(this.model, &#39;firstName&#39;)};`;
    }
  );
  
  aComputed = computed(&#39;aString&#39;, function(this: AnExample): number {
    return this.lookAString.length;
  });
  
  isLoggedIn = bool(&#39;session.user&#39;);
  savedUser: Computed&lt;Person&gt; = alias(&#39;session.user&#39;);</code></pre>
<!-- TODO: describe `this` -->
<!-- TODO: describe types -->
<p>But some things, TypeScript does not and cannot validate ‚Äì a number of the computed property macros are in this bucket, because they tend to be used for nested keys, and as noted above, TypeScript does not and <em>cannot</em> validate nested keys like that.</p>
</section>
<section id="actions" class="level3">
<h3>Actions</h3>
<p>What about actions? As usual, these just become class instance properties in the current scheme.</p>
<pre class="typescript"><code>  actions = {
    addToCollection(this: AnExample, value: string) {
      const current = this.get(&#39;aCollection&#39;);
      this.set(&#39;aCollection&#39;, current.concat(value));
    }
  };</code></pre>
<p>As with computed properties, we need the <code>this</code> type declaration to tell TypeScript that this method is going to be automatically bound to the class instance. Otherwise, TypeScript thinks the this is the <code>actions</code> hash.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
</section>
<section id="class-property-variants" class="level3">
<h3>Class property variants</h3>
<p>There are two times when things will look different from basic class properties. Both have to do with setting up the prototype to work the way other parts of the Ember object ecosystem expect.</p>
<section id="prototypalmerged-properties" class="level4">
<h4>Prototypal/merged properties</h4>
<p>The first is when you‚Äôre using properties that need to be merged with properties in the prototype chain, e.g. <code>attributeBindings</code> or <code>classNameBindings</code>, or which (because of details of how components are constructed) have to be set on the prototype rather than as instance properties, e.g. <code>tagClass</code>.</p>
<p>For those, we can just leverage <code>.extend</code> in conjunction with classes:</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;

export default class MyListItem extends Component.extend({
  tagName: &#39;li&#39;,
  classNameBindings: [&#39;itemClass&#39;]
}) {
  itemClass = &#39;this-be-a-list&#39;;

  // etc.
}</code></pre>
<p>This is also how you‚Äôll <em>use</em> mixins (on defining them, see below):</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;
import MyMixin from &#39;my-app/mixins/my-mixin&#39;;

export default class AnExample extends Component.extend(MyMixin) {
  // the rest of the definition.
}</code></pre>
<p>Note, however‚Äîand this is very important‚Äîthat you cannot <code>.extend</code> an existing <code>class</code> implementation. As a result, deep inheritance hierarchies <em>may</em> make transitioning to classes in Ember painful. Most importantly: they may work <em>some</em> of the time in <em>some</em> ways, but will break when you least expect. So don‚Äôt do that! (This isn‚Äôt a TypeScript limitation; it‚Äôs a limitation of classes in Ember today.)<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
</section>
<section id="mixins" class="level4">
<h4>Mixins</h4>
<p>The other time you‚Äôll have to take a different tack is with types which don‚Äôt yet work properly with classes. The most common of these are <code>Mixin</code>s and Ember Data objects. For <code>Mixin</code>s, sadly, it‚Äôs difficult (if not impossible) to get rigorous type-checking in their definitions. However, you can add appropriate type definitions to them and those will be picked up in <code>class</code>es which consume them.</p>
<aside>
<p>Note that if you‚Äôre writing <em>new</em> code in Ember.js‚Äîusing TypeScript or not‚ÄîI strongly encourage you to simply avoid using mixins at all. Instead, use services. This will require you to change how you write some of your code, but in my experience that change will make your codebase much easier to understand, and therefore much easier to maintain.</p>
</aside>
</section>
</section>
<section id="constructor-and-class-methods" class="level3">
<h3><code>constructor</code> and class methods</h3>
<p>ES6 class constructors and class methods both work as you‚Äôd expect, though as we‚Äôll see you‚Äôll need an extra bit of boilerplate for methods, at least for now.</p>
<pre class="typescript"><code>  constructor() {
    super();
    assert(&#39;`model` is required&#39;, !isNone(this.model));

    this.includeAhoy();
  }

  includeAhoy(this: AnExample): void {
    if (!this.get(&#39;aCollection&#39;).includes(&#39;ahoy&#39;)) {
      this.set(&#39;aCollection&#39;, current.concat(&#39;ahoy&#39;));
    }
  }</code></pre>
<p>For the most part, you can just switch to using normal ES6 class constructors instead of the Ember <code>init</code> method. You can, if you so desire, also convert existing instances of <code>init</code> to class methods, and they‚Äôll work once you change <code>this._super(...arguments)</code> to <code>super.init(...arguments)</code>. It‚Äôs worth pausing to understand the relationship between <code>init</code> and prototypal <code>init</code> and the <code>constructor</code>. An <code>init</code> in the <code>.extends()</code> hash runs first, then an <code>init</code> method on the class, then the normal <code>constructor</code>.</p>
<p>(You can see this for yourself in <a href="https://ember-twiddle.com/36844717dcc50d734139368edf2e87da">this Ember Twiddle</a>‚Äîjust open your developer tools and note the sequence.)</p>
<!-- TODO: regular class methods and `this: TheThing` -->
</section>
</section>
<section id="summary" class="level2">
<h2>Summary</h2>
<p>So that‚Äôs a wrap on components (and controllers, which behave much the same way).</p>
<p>In the next post, I‚Äôll look at the elephant in the room: Ember Data. While you <em>can</em> make Ember Data stuff largely work today, it‚Äôs still a ways from *Just Works‚Ñ¢Ô∏è_, sadly, and</p>
</section>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In the future, this problem will hopefully be solved neatly by decorators:</p>
<pre class="typescript"><code>  @action
  addToCollection(value: string) {
    const current = this.get(&#39;aCollection&#39;);
    this.set(&#39;aCollection&#39;, current.concat(value));
  }</code></pre>
<p>For today, however, specifying a <code>this</code> type is where it‚Äôs at.<a href="#fnref1" class="footnote-back">‚Ü©</a></p></li>
<li id="fn2"><p>In the future, we‚Äôll (hopefully and presumably ü§ûüèº) have an escape hatch for those merged or prototypally-set properties via decorators. That‚Äôll look something like this:</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;
import { className, tagName } from &#39;ember-decorators/component&#39;;

@tagName(&quot;li&quot;)
export default class MyListItem extends Component {
  @className itemClass = &#39;this-be-a-list&#39;;

  @action
  sendAMessage(contents: string): void {

  }
  // etc.
}</code></pre>
<a href="#fnref2" class="footnote-back">‚Ü©</a></li>
</ol>
</section>
        </div>
    </div>
</article>


    <footer id="site-footer"><section id="connect">
    <h2>Connect</h2>
    <ul class="icons">
        <li><a href="https://twitter.com/chriskrycho"><i class="fa fa-fw fa-twitter"></i>Twitter</a></li>
        <li><a href="mailto:chris at chriskrycho dot com"><i class="fa fa-fw fa-envelope"></i>Email</a></li>
        <li><a href="https://github.com/chriskrycho"><i class="fa fa-fw fa-github"></i>GitHub</a></li>
        <li><a href="https://medium.com/@chriskrycho"><i class="fa fa-fw fa-medium"></i>Medium</a></li>
        <li><a href="https://soundcloud.com/chriskrycho"><i class="fa fa-fw fa-soundcloud"></i>SoundCloud</a></li>
        <li><a href="http://instagram.com/chriskrycho"><i class="fa fa-fw fa-instagram"></i>Instagram</a></li>
        <li><a href="http://www.linkedin.com/in/chriskrycho"><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a></li>
        <li><a href="https://vimeo.com/chriskrycho"><i class="fa fa-fw fa-vimeo"></i>Vimeo</a></li>
        <li><a href="http://stackoverflow.com/users/564181/chris-krycho"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a></li>
    </ul>
</section>
<section id="subscribe">
    <h2>Subscribe</h2>
    <ul class="icons">
        <li class="section-title">
            <a onclick="window.open('http://eepurl.com/GzswP', 'subscribe', 'width=608,height=608')">
                   <i class="fa fa-fw fa-envelope"></i>Email
            </a>
        </li>
    </ul>
    <h3>Feeds</h3>
    <ul class="icons">
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feed.xml"><i class="fa fa-fw fa-rss"></i>Everything</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Art.xml"><i class="fa fa-fw fa-rss"></i>Art</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/blog.xml"><i class="fa fa-fw fa-rss"></i>blog</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Tech.xml"><i class="fa fa-fw fa-rss"></i>Tech</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Theology.xml"><i class="fa fa-fw fa-rss"></i>Theology</a>
        </li>
    </ul>
</section>
<section id="recent">
    <h2>Recent</h2>
    <ul>
        <li>Art: <a href="http://www.chriskrycho.com/2017/icehenge.html">Icehenge</a></li>
        <li>Blog: <a href="http://www.chriskrycho.com/2018/getting-the-right-things-done.html">Getting the Right Things Done</a></li>
        <li>Tech: <a href="http://www.chriskrycho.com/2018/typing-your-ember-update-part-2.html">TypeScript and Ember.js Update, Part 2</a></li>
        <li>Theology: <a href="http://www.chriskrycho.com/2017/on-public-theological-histories.html">On Public (Theological) Histories</a></li>
    </ul>
</section></footer>

    <script async src="http://code.bib.ly/bibly.min.js"></script>
    <link href="http://code.bib.ly/bibly.min.css" rel="stylesheet" />
    <script type="text/javascript">
    var MTIProjectId='a34d2e31-99b5-469a-9b81-128fc0bd9745';
    </script>

<link rel="stylesheet" href="/assets/tomorrow.min.css">
<script src="/assets/js/highlight.pack.js"></script>
<script type="text/javascript">
// Get all the <pre><code> elements, and use the <pre> element to set the <code>
// element's class so hljs will use it rather than trying to figure it out.
var preEls = document.getElementsByTagName('pre');
for (var e in preEls) {
    var pre = preEls[e];
    if (pre.firstChild && pre.firstChild.tagName === 'CODE') {
        var code = pre.firstChild;
        code.className = pre.className;
    }
}

// Then run hljs.
hljs.initHighlightingOnLoad();
</script>

<script type="text/javascript" src="/assets/js/lib.js"></script>
</body>
</html>