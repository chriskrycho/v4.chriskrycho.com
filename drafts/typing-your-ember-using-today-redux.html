<!DOCTYPE html>
<html lang="en">
<head>
    <title>Using Ember.js in your Apps Today, Revisited &middot; Chris Krycho</title>
    <meta name="description" content="TODO"/>

    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

<link rel='me' href='https://alpha.app.net/chriskrycho' data-type='follow' data-user-id='@chriskrycho'/>    <meta property="og:url" content="http://www.chriskrycho.com/drafts/typing-your-ember-using-today-redux.html"/>
    <meta property="og:title" content="Using Ember.js in your Apps Today, Revisited"/>
    <meta property="og:description" content="TODO"/>
        <meta property="og:image" content="http://www.chriskrycho.com//assets/images/ck.png"/>
<link rel="author" href=""/>
<link rel="me" href=""/><meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@chriskrycho"/>
<meta name="twitter:creator" content="@chriskrycho"/>
    <meta name="twitter:title" content="Using Ember.js in your Apps Today, Revisited"/>
    <meta name="twitter:description" content="TODO"/>
        <meta name="twitter:image" content="http://www.chriskrycho.com/assets/images/ck.png"/>
    <link rel="me" href="https://bitbucket.org/chriskrycho"/>
    <link rel="me" href="mailto:chris at chriskrycho dot com"/>
    <link rel="me" href="https://www.facebook.com/chriskrycho"/>
    <link rel="me" href="https://github.com/chriskrycho"/>
    <link rel="me" href="http://instagram.com/chriskrycho"/>
    <link rel="me" href="http://www.linkedin.com/in/chriskrycho"/>
    <link rel="me" href="https://medium.com/@chriskrycho"/>
    <link rel="me" href="https://soundcloud.com/chriskrycho"/>
    <link rel="me" href="http://stackoverflow.com/users/564181/chris-krycho"/>
    <link rel="me" href="https://twitter.com/chriskrycho"/>
    <link rel="me" href="https://vimeo.com/chriskrycho"/>

    <link rel="openid.delegate" href="http://www.chriskrycho.com/" />
    <link rel="openid.server" href="https://indieauth.com/openid" />

    <link rel="stylesheet" type="text/css" href="/assets/style.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/fonts.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css'>

    <link href="/favicon.png" type="image/png" rel="icon" />
    <link href="/favicon.ico" type="image/ico" rel="icon" />

    <script type="text/javascript" src="/assets/js/mtiFontTrackingCode.js"></script>


    <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="All posts">
        <link rel="alternate" href="/feeds/Art.xml" type="application/rss+xml" title="Posts filed in in 'Art''">
        <link rel="alternate" href="/feeds/blog.xml" type="application/rss+xml" title="Posts filed in in 'Blog''">
        <link rel="alternate" href="/feeds/Tech.xml" type="application/rss+xml" title="Posts filed in in 'Tech''">
        <link rel="alternate" href="/feeds/Theology.xml" type="application/rss+xml" title="Posts filed in in 'Theology''">
</head>
<body>
    <header id="site-header">
        <div class="hgroup">
            <h1 id="site-title">
<a href="http://www.chriskrycho.com"><img class="logotype" src="/assets/images/ck.png" alt="ck"/>Chris Krycho</a>
</h1>

            <h2 id="site-subtitle">Theology, technology, life & art</h2>
        </div>

        <nav>
            <ul>
                <li class="section-title"><a href="http://www.chriskrycho.com/about.html">About</a></li>
                <li class="section-title art"><a href="http://www.chriskrycho.com/art/">Art</a></li>
                <li class="section-title tech"><a href="http://www.chriskrycho.com/tech/">Tech</a></li>
                <li class="section-title theology"><a href="http://www.chriskrycho.com/theology/">Theology</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/series.html">Series</a></li>
                <li class="section-title divider" role="presentation"></li>
                <li class="section-title"><a href="http://www.chriskrycho.com/now.html">Now</a></li>
            </ul>
        </nav>

    </header>


<article class="typescript emberjs typing-your-ember tech">

    <header>
<h1>Using Ember.js in your Apps Today, Revisited</h1>
<h2>How do things look in early 2018? Pretty good, actually!</h2>    </header>

    <div class="meta">
<span class="date"><a href="http://www.chriskrycho.com/drafts/typing-your-ember-using-today-redux.html"><i class="fa fa-fw fa-link"></i></a>January 12, 2018</span><span class="section">Filed under <a class="section-title" href="http://www.chriskrycho.com/tech/">Tech</a></span><span class="hashtag"><a class="hashtags" href="http://www.chriskrycho.com/emberjs/">#emberjs</a><a class="hashtags" href="http://www.chriskrycho.com/typescript/">#typescript</a><a class="hashtags" href="http://www.chriskrycho.com/typing-your-ember/">#typing-your-ember</a></span><span><a href="http://www.chriskrycho.com/2018/typing-your-ember-using-today-redux.txt">Markdown source</a></span>    </div>

    <div class="content-wrapper">


        <div class="content">

<p><i class='series-overview'>You write <a href="https://emberjs.com">Ember.js</a> apps. You think <a href="http://www.typescriptlang.org">TypeScript</a> would be helpful in building a more robust app as it increases in size or has more people working on it. But you have questions about how to make it work.</i></p>
<p><i class='series-overview'>This is the series for you! I‚Äôll talk through everything: from the very basics of how to set up your Ember.js app to use TypeScript to how you can get the most out of TypeScript today‚Äîand I‚Äôll be pretty clear about the current tradeoffs and limitations, too.</i></p>
<p><i class='series-overview'><a href="/typing-your-ember.html">(See the rest of the series. ‚Üí)</a></i></p>
<hr />
<p>Back in July 2017, I wrote <a href="http://www.chriskrycho.com/2017/typing-your-ember-part-3.html">a post</a> on how to using TypeScript in your Ember.js apps. At the time, we were still busy working on getting the typings more solid for Ember itself, and <code>class</code> syntax for Ember was a long way away.</p>
<p>Things have gotten quite a bit better since then, so I thought I‚Äôd update that post with recommendations for using TypeScript in an app <em>now</em> with the updated typings, as well as with another six months of experience using TypeScript in our app at Olo (~20k lines of code in the app and another ~15k in tests).</p>
<aside>
<p>If you‚Äôre interested in all of this and would like to learn more in person, I‚Äôm <a href="http://emberconf.com/speakers.html#chris-krycho">leading a workshop on it at EmberConf 2018</a>‚ÄîI‚Äôd love to see you there!</p>
</aside>
<section id="normal-ember-objects" class="level2">
<h2>Normal Ember objects</h2>
<p>For normal Ember objects, things now <em>mostly</em> just work if you‚Äôre using class-based syntax, with a single (though very important) qualification I‚Äôll get to in a minute. And you can use the class-based syntax <em>today</em> in Ember.js‚Äîall the way back to 1.13, as it turns out. If you want to learn more, you can read <a href="https://github.com/emberjs/rfcs/blob/master/text/0240-es-classes.md">this RFC</a> or <a href="https://medium.com/build-addepar/es-classes-in-ember-js-63e948e9d78e">this blog post</a>, both by <a href="https://github.com/pzuraq">@pzuraq (Chris Garrett)</a>, who did most of the legwork to research this and flesh out the constraints, and who has also been doing a lot of work on <a href="https://ember-decorators.github.io/ember-decorators/docs/index.html">Ember Decorators</a>.</p>
<p>A few quick notes before I dig into some specific examples</p>
<ol type="1">
<li><!-- `class` vs. using variables and "Cannot use 'new' with an expression whose type lacks a call or construct signature." --></li>
<li><!-- --></li>
</ol>
<section id="a-detailed-example" class="level3">
<h3>A detailed example</h3>
<p>That means that every new bit of code I write today in our app looks roughly like this, with only the obvious modifications for services, routes, and controllers‚ÄîI picked components because they‚Äôre far and away the most common things in our applications.</p>
<p>In order to explain all this clearly, I‚Äôm going to first show the whole component, then zoom in on and explain specific parts of it.</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;
import { computed, get } from &#39;@ember/object&#39;;
import Computed from &#39;@ember/object/computed&#39;;
import { inject as service } from &#39;@ember/service&#39;;
import { assert } from &#39;@ember/debug&#39;;
import { isNone } from &#39;@ember/utils&#39;;

import Session from &#39;my-app/services/session&#39;
import Person from &#39;my-app/models/person&#39;;

export default class AnExample extends Component {
  // -- Component arguments -- //
  model: Person;      // required
  modifier?: string;  // optional, thus the `?`
  
  // -- Injections -- //
  session: Computed&lt;Session&gt; = service();

  // -- Class properties -- //
  aString = &#39;this is fine&#39;;
  aCollection: string[] = [];
  
  // -- Computed properties -- //
  // TS correctly infers computed property types when the callback has a
  // return type annotation.
  fromModel = computed(&#39;model.firstName&#39;, function(this: AnExample): string {
    return `My name is ${get(this.model, &#39;firstName&#39;)};`;
  })
  aComputed = computed(&#39;aString&#39;, function(this: AnExample): number {
    return this.lookAString.length;
  });
  isLoggedIn = bool(&#39;session.user&#39;);
  savedUser: Computed&lt;Person&gt; = alias(&#39;session.user&#39;);
  
  actions = {
    addToCollection(this: AnExample, value: string) {
      const current = this.get(&#39;aCollection&#39;);
      this.set(&#39;aCollection&#39;, current.concat(value));
    }
  };
  
  constructor() {
    super();
    assert(&#39;`model` is required&#39;, !isNone(this.model));
    
    this.includeAhoy();
  }
  
  includeAhoy(this: AnExample) {
    if (!this.get(&#39;aCollection&#39;).includes(&#39;ahoy&#39;)) {
      this.set(&#39;aCollection&#39;, current.concat(&#39;ahoy&#39;));
    }
  }
}</code></pre>
<section id="component-arguments" class="level4">
<h4>Component arguments</h4>
<pre class="typescript"><code>export default class AnExample extends Component {
  // Component arguments
  model: Person;      // required
  modifier?: string;  // optional, thus the `?`</code></pre>
<p>I always put these first so that the ‚Äúinterface‚Äù of the object is clear and obvious. You can do the same thing on a controller instance; in that case you would export a <code>Model</code> from the corresponding <code>Route</code> class and import it into the <code>Controller</code>. It‚Äôs a bit of boilerplate, to be sure, but it lets you communicate your interface clearly to consumers of the <code>Component</code> or <code>Controller</code>.</p>
<p>An important note about these kind of arguments: you do <em>not</em> have to do <code>this.get(...)</code> (or, if you prefer, <code>get(this, ...)</code>) to access the properties themselves: they‚Äôre class instance properties. You can simply access them as normal properties: <code>this.model</code>, <code>this.modifier</code>, etc. That even goes for referencing them as computed properties, as we‚Äôll see below.</p>
</section>
<section id="injections" class="level4">
<h4>Injections</h4>
<pre class="typescript"><code>  // -- Injections -- //
  session: Computed&lt;Session&gt; = service();</code></pre>
<p>Here, the most important thing to note is the required type annotation. In principle, we could work around this by requiring you to explicitly name the service and using a ‚Äútype registry‚Äù to look up what the service type is ‚Äì more on that below in my discussion of using Ember Data ‚Äì but I‚Äôm not yet persuaded that‚Äôs better than just writing the appropriate type annotation. Either way, there‚Äôs some duplication. ü§î We (everyone working in the <a href="https://github.com/typed-ember">typed-ember</a> project) would welcome feedback here, because the one thing we <em>can‚Äôt</em> do is get the proper type <em>without</em> one or the other of these.</p>
<pre class="typescript"><code>  // the current approach -- requires importing `Session` so you can define it
  // on the property here
  session: Computed&lt;Session&gt; = service();
  
  // the alternative approach I&#39;ve considered -- requires writing boilerplate
  // elsewhere, similar to what you&#39;ll see below in the Ember Data section
  session = service(&#39;session&#39;);</code></pre>
<p>One other thing to notice here is that because TypeScript is a <em>structural</em> type system, it doesn‚Äôt matter if what is injected is the actual <code>Session</code> service; it just needs to be something that <em>matches the shape</em> of the service ‚Äì so your normal behavior around dependency injection, etc. is all still as expected.</p>
</section>
<section id="class-properties" class="level4">
<h4>Class properties</h4>
<pre class="typescript"><code>  // -- Class properties -- //
  aString = &#39;this is fine&#39;;
  aCollection: string[] = [];</code></pre>
<p>Class properties like this are <em>instance properties</em>. These are compiled to, because they are <em>equivalent to</em>, assigning a property in the constructor. That is, these are equivalent:</p>
<pre class="typescript"><code>// class property assignment
class AnyClass {
  aClassProperty = &#39;yay&#39;;
  constructor() {
    console.log(&#39;all done constructing&#39;);
  }
}</code></pre>
<pre class="typescript"><code>// constructor assignment
class AnyClass {
  aClassProperty: string;
  constructor() {
    this.aClassProperty = &#39;yay&#39;;
    console.log(&#39;all done constructing&#39;);
  }
}</code></pre>
<p>This is <em>quite</em> unlike using <code>.extend</code>, which installs the property on the prototype. Two very significant differences fall out of this.</p>
<ol type="1">
<li><p>Since this runs during the constructor, if you make an assignment like this, but want the caller to be able to override it, you <em>must</em> write it out with an explicit fallback.</p>
<pre class="typescript"><code>export default class MyComponent extends Component {
  aDefaultProp = this.aDefaultProp || 0;
}</code></pre>
<p>(In our codebase, we have started using <a href="https://lodash.com/docs/4.17.4#defaultTo"><code>_.defaultTo</code></a>, which works quite nicely.)</p></li>
<li><p>Because these are instance properties, <em>not</em> assigned on the prototype, you do not have to worry about</p>
<pre class="typescript"><code>export default Component.extend({
  anArray: [],  // &lt;- this will be shared between instances
})</code></pre>
<pre class="typescript"><code>export default class extends Component {
  anArray = [];  // &lt;- this will *not* be shared between instances
}</code></pre>
<!-- TODO: explain consequence of that for the `[]` type --></li>
</ol>
</section>
<section id="computed-properties" class="level4">
<h4>Computed properties</h4>
<pre class="typescript"><code>  // -- Computed properties -- //
  // TS correctly infers computed property types when the callback has a
  // return type annotation.
  fromModel = computed(&#39;model.firstName&#39;, function(this: AnExample): string {
    return `My name is ${get(this.model, &#39;firstName&#39;)};`;
  })
  aComputed = computed(&#39;aString&#39;, function(this: AnExample): number {
    return this.lookAString.length;
  });
  isLoggedIn = bool(&#39;session.user&#39;);
  savedUser: Computed&lt;Person&gt; = alias(&#39;session.user&#39;);</code></pre>
<p>But some things, TypeScript does not and cannot validate ‚Äì a number of the computed property macros are in this bucket, because they tend to be used for nested keys, and as noted above, TypeScript does not and <em>cannot</em> validate nested keys like that.</p>
<section id="variants" class="level5">
<h5>Variants</h5>
<p>There are two times when things will look different.</p>
<p>The first is when you‚Äôre using properties that need to be merged with properties in the prototype chain, e.g. <code>attributeBindings</code> or <code>classNameBindings</code>, or which (because of details of how components are constructed) have to be set on the prototype rather than as instance properties, e.g. <code>tagClass</code>.</p>
<p>For those, we can just leverage <code>.extend</code> in conjunction with classes:</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;

export default class MyListItem extends Component.extend({
  tagName: &#39;li&#39;,
  classNameBindings: [&#39;itemClass&#39;],
}) {
  itemClass = &#39;this-be-a-list&#39;;
  
  // etc.
}</code></pre>
<p>This is also how you‚Äôll <em>use</em> mixins (on defining them, see below):</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;
import MyMixin from &#39;my-app/mixins/my-mixin&#39;;

export default class AnExample extends Component.extend(MyMixin) {
  // the rest of the definition.
}</code></pre>
<p>Note, however‚Äîand this is very important‚Äîthat you cannot <code>.extend</code> an existing <code>class</code> implementation. As a result, deep inheritance hierarchies <em>may</em> make transitioning to classes in Ember painful. (This isn‚Äôt a TypeScript limitation; it‚Äôs a limitation of classes in Ember today.)</p>
<p>In the future, we‚Äôll (hopefully and presumably) have an escape hatch for those merged or prototypally-set properties via decorators. That‚Äôll look something like this:</p>
<pre class="typescript"><code>import Component from &#39;@ember/component&#39;;
import { className, tagName } from &#39;ember-decorators/component&#39;;

@tagName(&#39;li&#39;)
export default class MyListItem extends Component {
  @className itemClass = &#39;this-be-a-list&#39;;
  
  // etc.
}</code></pre>
<p>The other time you‚Äôll have to take a different tack is with types which don‚Äôt yet work properly with classes. The most common of these are <code>Mixin</code>s and Ember Data objects. For <code>Mixin</code>s, sadly, it‚Äôs difficult (if not impossible) to get rigorous type-checking in their definitions. However, you can add appropriate type definitions to them and those will be picked up in <code>class</code>es which consume them.</p>
<aside>
<p>Note that if you‚Äôre writing <em>new</em> code in Ember.js‚Äîusing TypeScript or not‚ÄîI strongly encourage you to simply avoid using mixins at all. Instead, use services. This will require you to change how you write some of your code, but in my experience it also makes for a much more maintainable and easier-to-understand (and therefore easier-to-maintain) codebase.</p>
</aside>
</section>
</section>
</section>
</section>
<section id="ember-data" class="level2">
<h2>Ember Data</h2>
<p>There are two challenges to using Ember Data effectively with TypeScript today.</p>
<ol type="1">
<li>Ember Data, for reasons I haven‚Äôt yet dug into myself, does not play nicely with ES6 classes. However, we <em>want</em> named class exports for the sake of being able to use them</li>
</ol>
<p>++TODO++</p>
<p>We also have some ideas and prototypes for how to make the experience of both of these much, <em>much</em> better. Sometime soon-ish‚Äîhopefully before EmberConf, where I‚Äôd really like to <em>not</em> have to mess with teaching the complicated ways above to make things work!‚Äîwe should land a solution that means you can drop the type coercions and just do a lookup like you would normally, and it will Just Work‚Ñ¢Ô∏è.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Note for Ember CLI Mirage users: most of what I‚Äôve said here is equally applicable and nearly identical for Mirage. I‚Äôm currently working on solid typings for Mirage that get us everything we need that way.</p>
</section>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>If you‚Äôre curious about the mechanics, we‚Äôre basically setting up a ‚Äútype registry‚Äù which maps the string keys to the correct model, so that the type of e.g. <code>store.createRecord('some-model', { ... })</code> will do a lookup in an interface which defines a mapping from model name, i.e. <code>some-model</code> here, to the model type, e.g. <code>export default class SomeModel extends DS.Model.extend({ ... }) {}</code>;<a href="#fnref1" class="footnote-back">‚Ü©</a></p></li>
</ol>
</section>
        </div>
    </div>
</article>


    <footer id="site-footer"><section id="connect">
    <h2>Connect</h2>
    <ul class="icons">
        <li><a href="https://twitter.com/chriskrycho"><i class="fa fa-fw fa-twitter"></i>Twitter</a></li>
        <li><a href="mailto:chris at chriskrycho dot com"><i class="fa fa-fw fa-envelope"></i>Email</a></li>
        <li><a href="https://github.com/chriskrycho"><i class="fa fa-fw fa-github"></i>GitHub</a></li>
        <li><a href="https://medium.com/@chriskrycho"><i class="fa fa-fw fa-medium"></i>Medium</a></li>
        <li><a href="https://soundcloud.com/chriskrycho"><i class="fa fa-fw fa-soundcloud"></i>SoundCloud</a></li>
        <li><a href="http://instagram.com/chriskrycho"><i class="fa fa-fw fa-instagram"></i>Instagram</a></li>
        <li><a href="http://www.linkedin.com/in/chriskrycho"><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a></li>
        <li><a href="https://vimeo.com/chriskrycho"><i class="fa fa-fw fa-vimeo"></i>Vimeo</a></li>
        <li><a href="http://stackoverflow.com/users/564181/chris-krycho"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a></li>
    </ul>
</section>
<section id="subscribe">
    <h2>Subscribe</h2>
    <ul class="icons">
        <li class="section-title">
            <a onclick="window.open('http://eepurl.com/GzswP', 'subscribe', 'width=608,height=608')">
                   <i class="fa fa-fw fa-envelope"></i>Email
            </a>
        </li>
    </ul>
    <h3>Feeds</h3>
    <ul class="icons">
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feed.xml"><i class="fa fa-fw fa-rss"></i>Everything</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Art.xml"><i class="fa fa-fw fa-rss"></i>Art</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/blog.xml"><i class="fa fa-fw fa-rss"></i>blog</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Tech.xml"><i class="fa fa-fw fa-rss"></i>Tech</a>
        </li>
        <li class="section-title">
            <a href="http://www.chriskrycho.com/feeds/Theology.xml"><i class="fa fa-fw fa-rss"></i>Theology</a>
        </li>
    </ul>
</section>
<section id="recent">
    <h2>Recent</h2>
    <ul>
        <li>Art: <a href="http://www.chriskrycho.com/2017/icehenge.html">Icehenge</a></li>
        <li>Blog: <a href="http://www.chriskrycho.com/2018/getting-the-right-things-done.html">Getting the Right Things Done</a></li>
        <li>Tech: <a href="http://www.chriskrycho.com/2018/exploring-4-languages-starting-to-model-the-domain.html">Exploring 4 Languages: Starting to Model the Domain</a></li>
        <li>Theology: <a href="http://www.chriskrycho.com/2017/on-public-theological-histories.html">On Public (Theological) Histories</a></li>
    </ul>
</section></footer>

    <script async src="http://code.bib.ly/bibly.min.js"></script>
    <link href="http://code.bib.ly/bibly.min.css" rel="stylesheet" />
    <script type="text/javascript">
    var MTIProjectId='a34d2e31-99b5-469a-9b81-128fc0bd9745';
    </script>

<link rel="stylesheet" href="/assets/tomorrow.min.css">
<script src="/assets/js/highlight.pack.js"></script>
<script type="text/javascript">
// Get all the <pre><code> elements, and use the <pre> element to set the <code>
// element's class so hljs will use it rather than trying to figure it out.
var preEls = document.getElementsByTagName('pre');
for (var e in preEls) {
    var pre = preEls[e];
    if (pre.firstChild && pre.firstChild.tagName === 'CODE') {
        var code = pre.firstChild;
        code.className = pre.className;
    }
}

// Then run hljs.
hljs.initHighlightingOnLoad();
</script>

<script type="text/javascript" src="/assets/js/lib.js"></script>
</body>
</html>